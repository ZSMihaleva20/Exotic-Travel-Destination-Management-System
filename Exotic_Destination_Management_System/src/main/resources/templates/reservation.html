<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Резервация</title>
    <script>
        function updateTotalPrice() {
            let numberOfPeople = document.getElementById("numberOfPeople").value;
            let pricePerPerson = document.getElementById("pricePerPerson").value;
            let totalPrice = numberOfPeople * pricePerPerson;
            document.getElementById("totalPrice").innerText = totalPrice.toFixed(2) + " лв.";
        }
    </script>
</head>
<body>
<h1>Резервация</h1>
<br>
<div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 20px;">
    <h2 th:text="${destination.name}">Име на дестинацията</h2>
    <img th:src="'/uploaded-image/' + ${destination.imageUrl}" alt="Destination Image">
    <p><strong>Описание:</strong>
    <ul
        th:utext="'<li>' + ${#strings.listJoin(#strings.arraySplit(destination.description, '\\;'), '</li><li>')} + '</li>'">
    </ul>
    </p>
    <p><strong>Дата на заминаване: </strong><span th:text="${#temporals.format(destination.dateOfDeparture, 'dd-MM-yyyy')}"></span></p>
    <p><strong>Дата на връщане: </strong><span th:text="${#temporals.format(destination.dateOfReturn, 'dd-MM-yyyy')}"></span></p>
    <p><strong>Цена за 1 човек:</strong> <span th:text="${destination.price}"></span> лв.</p>
</div>

<form th:action="@{/destinations}" method="post">
    <input type="hidden" name="destinationId" th:value="${destination.id}">
    <input type="hidden" id="pricePerPerson" th:value="${destination.price}">

    <label>Име:</label>
    <input type="text" name="name" th:value="${#authentication.principal.firstName + ' ' + #authentication.principal.lastName}">
    <br><br>

    <label>Имейл:</label>
    <input type="email" name="email" th:value="${#authentication.principal.email}">
    <br><br>

    <label>Брой хора:</label>
    <input type="number" id="numberOfPeople" name="numberOfPeople" required min="1"
           th:max="${destination.remainingPeople}" oninput="updateTotalPrice()">
    <br><br>

    <h3>Информация за плащането</h3>
    <label>Тип карта:</label>
    <input type="radio" id="visa" name="cardType" value="Visa" required>
    <label for="visa">
        <img src="https://cdn.iconscout.com/icon/free/png-256/free-visa-logo-icon-download-in-svg-png-gif-file-formats--payment-method-gateway-logos-pack-icons-675739.png" alt="Visa" width="40">
    </label>

    <input type="radio" id="mastercard" name="cardType" value="MasterCard" required>
    <label for="mastercard">
        <img src="https://new.sportal365images.com/process/smp-images-production/profit.bg/24012024/e61bef22-9271-4d5d-9406-6e7ff988f4fe.jpg?operations=autocrop(256:256)" alt="MasterCard" width="40">
    </label>
    <br><br>

    <label>Име на картодържателя:</label>
    <input type="text" name="cardName" required>

    <label>Номер на карта:</label>
    <input type="text" name="cardNumber" required>
    <br><br>

    <label>Дата на изтичане:</label>
    <input type="text" name="expiryDate" required>

    <label>CVC:</label>
    <input type="text" name="cvc" required>
    <br><br>

    <h3>Обща цена: <span id="totalPrice">0.00 лв.</span></h3>  <!-- Dynamic Price Update -->

    <button type="submit">Резервирай</button>
</form>

<a href="/destinations">Върни се в главната страница</a>
</body>
</html>
