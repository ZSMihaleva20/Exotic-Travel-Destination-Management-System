<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="bg">
<head>
    <title>Управление на дестинации</title>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="/css/destinationsPageStyle.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body class="bg-gray-100 text-gray-800 pt-20 opacity-0 transition-opacity duration-700 ease-out">

<!-- Main Layout -->
<nav class="fixed top-0 w-full bg-white shadow-md backdrop-blur-md z-50">
    <div class="container mx-auto flex items-center justify-between py-4 px-6">

        <!-- Left Side: Logo -->
        <h2 class="text-3xl font-extrabold text-yellow-500"><a href="/">Exotico</a></h2>

        <!-- Center: Navigation Links -->
        <div class="hidden md:flex space-x-8 mx-auto">
            <a href="/destinations" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition"> Дестинации</a>
            <a href="/promotionsAndCampaigns" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition">Промоции и кампании</a>
            <a href="/statistics" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition"> Статистики</a>
        </div>

        <!-- Right Side: User Menu -->
        <div class="relative">
            <div class="bg-gray-800 text-white px-6 py-2 rounded-lg cursor-pointer flex items-center gap-2" id="userMenu">
                <span class="material-symbols-outlined">person</span>
                <span class="font-semibold">Моят акаунт</span>
            </div>

            <!-- Dropdown Menu -->
            <div id="dropdownMenu" class="absolute right-0 mt-2 bg-white text-gray-900 p-4 rounded shadow-md w-48 hidden transition">
                <a href="/profile" class="block py-2">Профил</a>
                <a href="/destinationManagement" class="block py-2">Управлявай дестинации</a>
                <a href="/ratingManagement" class="block py-2">Управлявай рейтинги</a>
                <a href="/reservationManagement" class="block py-2"> Управлявай резервации</a>
                <th:block th:if="${#strings.equals(user.getRole(), 'ADMIN')}">
                    <a href="/profilesManagement" class="block py-2">Управлявай профили</a>
                </th:block>
                <a href="/logout" class="block py-2 text-red-500">Изход</a>
            </div>
        </div>
    </div>
</nav>

<div class="w-full px-6">
    <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center mt-8">Управление на дестинации</h1>

    <div class="flex justify-end mb-6">
        <a href="/addDestination" class="bg-yellow-500 text-white px-5 py-2 rounded-lg shadow-md hover:bg-yellow-600 transition">
            + Добави нова дестинация
        </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div th:each="destination : ${destinations}" class="bg-white shadow-md rounded-lg overflow-hidden p-4 flex flex-col">
            <!-- Destination Image -->
            <img th:src="@{'/uploaded-image/' + ${destination.imageUrl}}" alt="Destination Image" class="w-full h-48 object-cover rounded-md">

            <!-- Destination Details -->
            <div class="mt-4 flex-grow">
                <h2 class="text-2xl font-semibold text-gray-800" th:text="${destination.name}"></h2>

                <p class="text-gray-600 text-sm mt-2">
                <ul th:utext="'<li>' + ${#strings.listJoin(#strings.arraySplit(destination.description, '\\;'), '</li><li>')} + '</li>'"></ul>
                </p>

                <div class="mt-4 flex flex-wrap gap-2">
                <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-sm">
                    От: <span th:text="${#temporals.format(destination.dateOfDeparture, 'dd-MM-yyyy')}"></span>
                </span>
                    <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-sm">
                    До: <span th:text="${#temporals.format(destination.dateOfReturn, 'dd-MM-yyyy')}"></span>
                </span>
                </div>

                <div class="flex justify-between items-center mt-4">
                    <span class="text-lg font-semibold text-green-600" th:text="${#numbers.formatDecimal(destination.price, 2, 2)} + ' лв.'"></span>
                    <span class="text-gray-700 text-sm">Макс. хора: <span th:text="${destination.limitedPeople}"></span></span>
                </div>
            </div>

            <!-- Status and Actions (Always at the bottom) -->
            <div class="mt-auto">
                <!-- Status -->
                <div class="mt-4">
                <span th:switch="${destination.status}" class="px-3 py-1 rounded-full text-sm font-semibold block text-center">
                    <span th:case="'ACCEPTED'" class="bg-green-100 text-green-600 px-3 py-1 rounded-md">ОДОБРЕНА</span>
                    <span th:case="'PENDING-ACCEPT'" class="bg-yellow-100 text-yellow-600 px-3 py-1 rounded-md">ИЗЧАКВА ОДОБРЕНИЕ</span>
                    <span th:case="'PENDING-EDIT'" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-md">ИЗЧАКВА ОДОБРЕНИЕ ЗА РЕДАКТИРАНЕ</span>
                    <span th:case="'PENDING-DELETE'" class="bg-red-100 text-red-600 px-3 py-1 rounded-md">ИЗЧАКВА ОДОБРЕНИЕ ЗА ИЗТРИВАНЕ</span>
                </span>
                </div>

                <!-- Actions -->
                <div class="mt-6 flex flex-wrap gap-2 justify-center">
                    <div sec:authorize="hasAuthority('ADMIN')" class="flex flex-wrap gap-2 justify-center">
                        <form th:if="${destination.status.startsWith('PENDING-')}" th:action="@{'/approveRequest/' + ${destination.id}}" method="post">
                            <button class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition">Приеми</button>
                        </form>
                        <form th:if="${destination.status.startsWith('PENDING-')}" th:action="@{'/declineRequest/' + ${destination.id}}" method="post">
                            <button class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition">Откажи</button>
                        </form>
                        <th:block th:if="${destination.status != 'PENDING-ACCEPT' and destination.status != 'PENDING-DELETE' and destination.status != 'PENDING-EDIT'}">
                            <a th:href="@{'/editDestination/' + ${destination.id}}" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">Редактирай</a>
                            <form th:action="@{'/delete/' + ${destination.id}}" method="post">
                                <button class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition">Изтрий</button>
                            </form>
                        </th:block>
                    </div>

                    <div sec:authorize="hasAuthority('MANAGER')" class="flex flex-wrap gap-2 justify-center mt-4">
                        <th:block th:if="${destination.status != 'PENDING-ACCEPT'}">
                            <a th:if="${destination.editApproved}" th:href="@{'/editDestination/' + ${destination.id}}" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">Редактирай</a>
                            <form th:if="${!destination.editApproved}" th:action="@{'/requestEdit/' + ${destination.id}}" method="post">
                                <button class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600 transition">Заявка за редактиране</button>
                            </form>
                            <form th:action="@{'/requestDelete/' + ${destination.id}}" method="post">
                                <button class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition">Заявка за изтриване</button>
                            </form>
                        </th:block>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<div class="mb-10"></div>
<script type="text/javascript" th:src="@{/js/destinationManagementScript.js}"></script>
</body>
</html>
