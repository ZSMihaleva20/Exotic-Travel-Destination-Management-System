<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="bg">
<head>
  <title>–ï–∫–∑–æ—Ç–∏—á–Ω–∏ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</title>
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
  <link rel="stylesheet" href="/css/destinationsPageStyle.css">
</head>
<body class="bg-gray-100 text-gray-800 pt-20 opacity-0 transition-opacity duration-700 ease-out">

<!-- Main Layout -->
<nav class="fixed top-0 w-full bg-white shadow-md backdrop-blur-md z-50">
  <div class="container mx-auto flex items-center justify-between py-4 px-6">

    <!-- Left Side: Logo -->
    <h2 class="text-3xl font-extrabold text-yellow-500"><a href="/">Exotico</a></h2>

    <!-- Center: Navigation Links -->
    <div class="hidden md:flex space-x-8 mx-auto">
      <a href="/destinations" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition"> –î–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</a>
      <a href="/promotionsAndCampaigns" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition">–ü—Ä–æ–º–æ—Ü–∏–∏ –∏ –∫–∞–º–ø–∞–Ω–∏–∏</a>
      <a href="/statistics" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition"> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</a>
    </div>

    <!-- Right Side: User Menu -->
    <div class="relative">
      <div class="bg-gray-800 text-white px-6 py-2 rounded-lg cursor-pointer flex items-center gap-2" id="userMenu">
        <span class="material-symbols-outlined">person</span>
        <span class="font-semibold">–ú–æ—è—Ç –∞–∫–∞—É–Ω—Ç</span>
      </div>

      <!-- Dropdown Menu -->
      <div id="dropdownMenu" class="absolute right-0 mt-2 bg-white text-gray-900 p-4 rounded shadow-md w-48 hidden transition">
        <a href="/profile" class="block py-2">–ü—Ä–æ—Ñ–∏–ª</a>

        <th:block th:if="${#strings.equals(user.role, 'ADMIN') or #strings.equals(user.role, 'MANAGER')}">
          <a href="/destinationManagement" class="block py-2">–£–ø—Ä–∞–≤–ª—è–≤–∞–π –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</a>
          <a href="/ratingManagement" class="block py-2">–£–ø—Ä–∞–≤–ª—è–≤–∞–π —Ä–µ–π—Ç–∏–Ω–≥–∏</a>
          <a href="/reservationManagement" class="block py-2"> –£–ø—Ä–∞–≤–ª—è–≤–∞–π —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</a>
        </th:block>

        <th:block th:if="${#strings.equals(user.role, 'ADMIN')}">
          <a href="/profilesManagement" class="block py-2">–£–ø—Ä–∞–≤–ª—è–≤–∞–π –ø—Ä–æ—Ñ–∏–ª–∏</a>
        </th:block>

        <th:block th:if="${#strings.equals(user.role, 'USER')}">
          <a href="/myReservations" class="block py-2">–ú–æ–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</a>
          <a href="/rateDestination" class="block py-2"> –î–æ–±–∞–≤–∏ —Ä–µ–π—Ç–∏–Ω–≥</a>
        </th:block>

        <a href="/logout" class="block py-2 text-red-500">–ò–∑—Ö–æ–¥</a>
      </div>
    </div>
  </div>
</nav>
<!-- Main Layout Container (Centers Content & Limits Width) -->
<!-- Main Layout Container (Increased Width) -->
<div class="container max-w-7xl mx-auto px-4 md:px-6">
  <h1 class="text-4xl font-bold text-gray-800 mb-6 text-center mt-8">–î–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</h1>

  <!-- Search & Filter Form (Centered & Compact) -->
  <form action="/destinations" method="get" class="bg-white p-6 rounded-lg shadow-md mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

      <!-- Search Keyword -->
      <div class="flex items-center gap-2">
        <label for="dateOfDeparture" class="text-sm font-medium text-gray-600 whitespace-nowrap">–¢—ä—Ä—Å–µ–Ω–µ:</label>
        <input type="text" name="keyword" placeholder="–ö–ª—é—á–æ–≤–∞ –¥—É–º–∞..." class="input-field w-full" th:value="${keyword}">
      </div>

      <!-- Departure Date -->
      <div class="flex items-center gap-2">
        <label for="dateOfDeparture" class="text-sm font-medium text-gray-600 whitespace-nowrap">–ó–∞–º–∏–Ω–∞–≤–∞–Ω–µ:</label>
        <input type="date" id="dateOfDeparture" name="dateOfDeparture" class="input-field w-full" th:value="${dateOfDeparture}">
      </div>

      <!-- Return Date -->
      <div class="flex items-center gap-2">
        <label for="dateOfReturn" class="text-sm font-medium text-gray-600 whitespace-nowrap">–í—Ä—ä—â–∞–Ω–µ:</label>
        <input type="date" id="dateOfReturn" name="dateOfReturn" class="input-field w-full" th:value="${dateOfReturn}">
      </div>

      <!-- Minimum Price -->
      <div class="flex items-center gap-2">
        <label for="dateOfDeparture" class="text-sm font-medium text-gray-600 whitespace-nowrap">–ú–∏–Ω–∏–º–∞–ª–Ω–∞ —Ü–µ–Ω–∞:</label>
        <input type="number" name="minPrice" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" class="input-field w-full" th:value="${minPrice}">
      </div>

      <!-- Maximum Price -->
      <div class="flex items-center gap-2">
        <label for="dateOfDeparture" class="text-sm font-medium text-gray-600 whitespace-nowrap">–ú–∞–∫—Å–∏–º–∞–ª–Ω–∞ —Ü–µ–Ω–∞:</label>
        <input type="number" name="maxPrice" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" class="input-field w-full" th:value="${maxPrice}">
      </div>

      <!-- Minimum Rating -->
      <div class="flex items-center gap-2">
        <label for="dateOfDeparture" class="text-sm font-medium text-gray-600 whitespace-nowrap">–ú–∏–Ω–∏–º–∞–ª–µ–Ω —Ä–µ–π—Ç–∏–Ω–≥:</label>
        <input type="number" name="minRating" min="0" max="5" step="0.1" placeholder="–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥" class="input-field w-full" th:value="${minRating}">
      </div>

      <!-- Sort Options -->
      <div class="col-span-3 flex justify-center items-center mt-4">
        <label for="sortOptions" class="text-sm font-medium text-gray-600 mr-2">–°–æ—Ä—Ç–∏—Ä–∞–π –ø–æ:</label>
        <select id="sortOptions" name="sortBy" class="input-field w-48 text-left">
          <option value="none" th:selected="${currentSort == 'none'}">–í—Å–∏—á–∫–∏</option>
          <option value="price" th:selected="${currentSort == 'price'}">–¶–µ–Ω–∞</option>
          <option value="popularity" th:selected="${currentSort == 'popularity'}">–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç</option>
          <option value="rating" th:selected="${currentSort == 'rating'}">–†–µ–π—Ç–∏–Ω–≥</option>
        </select>
      </div>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary mt-4 w-full">–§–∏–ª—Ç—Ä–∏—Ä–∞–π –∏ —Å–æ—Ä—Ç–∏—Ä–∞–π</button>
  </form>

  <!-- Destination Cards (Centered & Limited Width) -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <th:block th:each="destination : ${acceptedDestinations}">
      <th:block th:if="${!destination.isOnPromotion}">
        <div class="destination-card bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transform hover:-translate-y-2 transition flex flex-col min-h-full relative p-4">

          <!-- Rating in the top-right corner -->
          <p class="absolute top-2 right-2 bg-blue-800 text-white font-bold px-3 py-1 rounded-lg shadow">
            ‚≠ê <span th:text="${destination.getAverageRating()}"></span>
          </p>

          <p class="absolute top-12 right-2 bg-green-600 text-white font-bold px-3 py-1 rounded-lg shadow">
            üî• <span th:text="${destination.getPopularity()}"></span> —Ä–µ–∑–µ—Ä–≤–∏—Ä–∞–ª–∏
          </p>

          <!-- Image -->
          <img th:src="'/uploaded-image/' + ${destination.imageUrl}"
               alt="Destination Image"
               class="w-full h-64 object-cover rounded-lg">

          <!-- Destination Info -->
          <div class="p-6 flex flex-col flex-grow">

            <!-- Destination Name -->
            <h2 class="text-xl font-bold text-gray-700" th:text="${destination.name}"></h2>

            <!-- Destination Description -->
            <ul class="text-gray-600 mt-2 list-disc pl-5"
                th:utext="${#strings.listJoin(#strings.arraySplit(destination.description, '\\;'), '</li><li>')}">
            </ul>

            <!-- Dates -->
            <p class="text-gray-700 font-bold mt-8">–î–∞—Ç–∞ –Ω–∞ –∑–∞–º–∏–Ω–∞–≤–∞–Ω–µ:
              <span th:text="${#temporals.format(destination.dateOfDeparture, 'dd-MM-yyyy')}"></span>
            </p>
            <p class="text-gray-700 font-bold">–î–∞—Ç–∞ –Ω–∞ –≤—Ä—ä—â–∞–Ω–µ:
              <span th:text="${#temporals.format(destination.dateOfReturn, 'dd-MM-yyyy')}"></span>
            </p>

            <!-- Remaining Seats -->
            <p class="mt-2 text-gray-700 font-bold">–û—Å—Ç–∞–≤–∞—â–∏ –º–µ—Å—Ç–∞:
              <span th:text="${destination.remainingPeople}"></span>
            </p>

            <!-- Reserve Button (Always at Bottom) -->
            <div class="mt-auto pt-4">
              <p class="text-black-200 font-extrabold text-xl mt-6 text-center">
                –¶–µ–Ω–∞: <span th:text="${#numbers.formatDecimal(destination.price, 2, 2)}"></span> –ª–≤.
              </p>

              <th:block th:if="${destination.remainingPeople == 0 or destination.dateOfDeparture <= T(java.time.LocalDate).now()}">
                <p class="text-red-500 font-bold mt-2 text-center">–ó–∞—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</p>
              </th:block>
              <div sec:authorize="hasAuthority('USER')">
                <th:block th:if="${destination.dateOfDeparture > T(java.time.LocalDate).now() and destination.remainingPeople != 0}">
                  <a th:href="@{/reservation/{id}(id=${destination.id})}">
                    <button class="btn btn-secondary w-full text-lg mt-4">–ù–∞–ø—Ä–∞–≤–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è</button>
                  </a>
                </th:block>
              </div>
            </div>

          </div>
        </div>
      </th:block>
    </th:block>
  </div>
</div>

<script type="text/javascript" th:src="@{/js/destinationsScript.js}"></script>
<div class="mb-10"></div>
</body>
</html>
