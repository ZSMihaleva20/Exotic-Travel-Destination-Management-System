<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="bg">
<head>
  <title>–ï–∫–∑–æ—Ç–∏—á–Ω–∏ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</title>
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
  <link rel="stylesheet" href="/css/destinationsPageStyle.css">
</head>
<body class="bg-gray-100 text-gray-800 pt-20 opacity-0 translate-y-10 transition-all duration-700 ease-out">

<!-- Main Layout -->
<nav class="fixed top-0 w-full bg-white shadow-md backdrop-blur-md z-50 h-16">
  <div class="container mx-auto flex items-center justify-between py-4 px-6">

    <!-- Left Side: Logo -->
    <a href="/" class="text-3xl font-extrabold text-yellow-500">Exotico</a>

    <!-- Center: Navigation Links -->
    <div class="hidden md:flex space-x-8 mx-auto">
      <a href="/destinations" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition">üèù –î–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</a>
      <a href="/promotionsAndCampaigns" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition">üî• –ü—Ä–æ–º–æ—Ü–∏–∏</a>
      <a href="/statistics" class="text-lg font-semibold text-gray-700 hover:text-yellow-500 transition">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</a>
    </div>

    <!-- Right Side: User Menu -->
    <div class="relative">
      <div class="bg-gray-800 text-white px-6 py-2 rounded-lg cursor-pointer flex items-center gap-2" id="userMenu">
        <span class="material-symbols-outlined">person</span>
        <span class="font-semibold">–ú–æ—è—Ç –∞–∫–∞—É–Ω—Ç</span>
      </div>

      <!-- Dropdown Menu -->
      <div id="dropdownMenu" class="absolute right-0 mt-2 bg-white text-gray-900 p-4 rounded shadow-md w-48 hidden transition">
        <a href="/profile" class="block py-2">üë§ –ü—Ä–æ—Ñ–∏–ª</a>

        <th:block th:if="${#strings.equals(user.role, 'ADMIN') or #strings.equals(user.role, 'MANAGER')}">
          <a href="/destinationManagement" class="block py-2">üåç –£–ø—Ä–∞–≤–ª—è–≤–∞–π –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏–∏</a>
          <a href="/ratingManagement" class="block py-2">‚≠ê –£–ø—Ä–∞–≤–ª—è–≤–∞–π —Ä–µ–π—Ç–∏–Ω–≥–∏</a>
          <a href="/reservationManagement" class="block py-2">üìÖ –£–ø—Ä–∞–≤–ª—è–≤–∞–π —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</a>
        </th:block>

        <th:block th:if="${#strings.equals(user.role, 'ADMIN')}">
          <a href="/profilesManagement" class="block py-2">üë• –£–ø—Ä–∞–≤–ª—è–≤–∞–π –ø—Ä–æ—Ñ–∏–ª–∏</a>
        </th:block>

        <th:block th:if="${#strings.equals(user.role, 'USER')}">
          <a href="/myReservations" class="block py-2">üìå –ú–æ–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</a>
          <a href="/rateDestination" class="block py-2">üí¨ –î–æ–±–∞–≤–∏ —Ä–µ–π—Ç–∏–Ω–≥</a>
        </th:block>

        <a href="/logout" class="block py-2 text-red-500">üö™ –ò–∑—Ö–æ–¥</a>
      </div>
    </div>
  </div>
</nav>
<!-- Main Layout Container (Centers Content & Limits Width) -->
<!-- Main Layout Container (Increased Width) -->
<div class="container max-w-7xl mx-auto px-4 md:px-6">


  <!-- Search & Filter Form (Centered & Compact) -->
  <form action="/destinations" method="get" class="bg-white p-6 rounded-lg shadow-md mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

      <!-- Search Keyword -->
      <div class="flex items-center gap-2">
        <span class="text-gray-400">üîç</span>
        <input type="text" name="keyword" placeholder="–ö–ª—é—á–æ–≤–∞ –¥—É–º–∞..." class="input-field w-full" th:value="${keyword}">
      </div>

      <!-- Departure Date -->
      <div class="flex items-center gap-2">
        <label for="dateOfDeparture" class="text-sm font-medium text-gray-600 whitespace-nowrap">–ó–∞–º–∏–Ω–∞–≤–∞–Ω–µ:</label>
        <input type="date" id="dateOfDeparture" name="dateOfDeparture" class="input-field w-full" th:value="${dateOfDeparture}">
      </div>

      <!-- Return Date -->
      <div class="flex items-center gap-2">
        <label for="dateOfReturn" class="text-sm font-medium text-gray-600 whitespace-nowrap">–í—Ä—ä—â–∞–Ω–µ:</label>
        <input type="date" id="dateOfReturn" name="dateOfReturn" class="input-field w-full" th:value="${dateOfReturn}">
      </div>

      <!-- Minimum Price -->
      <div class="flex items-center gap-2">
        <span class="text-gray-400">üí∞</span>
        <input type="number" name="minPrice" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" class="input-field w-full" th:value="${minPrice}">
      </div>

      <!-- Maximum Price -->
      <div class="flex items-center gap-2">
        <span class="text-gray-400">üí∞</span>
        <input type="number" name="maxPrice" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" class="input-field w-full" th:value="${maxPrice}">
      </div>

      <!-- Minimum Rating -->
      <div class="flex items-center gap-2">
        <span class="text-gray-400">‚≠ê</span>
        <input type="number" name="minRating" min="0" max="5" step="0.1" placeholder="–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥" class="input-field w-full" th:value="${minRating}">
      </div>

      <!-- Sort Options -->
      <div class="col-span-3 flex justify-center items-center mt-4">
        <label for="sortOptions" class="text-sm font-medium text-gray-600 mr-2">–°–æ—Ä—Ç–∏—Ä–∞–π –ø–æ:</label>
        <select id="sortOptions" name="sortBy" class="input-field w-48 text-center">
          <option value="none" th:selected="${currentSort == 'none'}">üìå –í—Å–∏—á–∫–∏</option>
          <option value="price" th:selected="${currentSort == 'price'}">üí∞ –¶–µ–Ω–∞</option>
          <option value="popularity" th:selected="${currentSort == 'popularity'}">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç</option>
          <option value="rating" th:selected="${currentSort == 'rating'}">‚≠ê –†–µ–π—Ç–∏–Ω–≥</option>
        </select>
      </div>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary mt-4 w-full">–§–∏–ª—Ç—Ä–∏—Ä–∞–π –∏ —Å–æ—Ä—Ç–∏—Ä–∞–π</button>
  </form>

  <!-- Destination Cards (Centered & Limited Width) -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <th:block th:each="destination : ${acceptedDestinations}">
      <th:block th:if="${!destination.isOnPromotion}">
        <div class="bg-white p-6 rounded-lg shadow-md flex flex-col min-h-full">

          <!-- Destination Name -->
          <h2 class="text-xl font-bold text-gray-700" th:text="${destination.name}"></h2>

          <!-- Destination Description -->
          <ul class="text-gray-600 mt-2 list-disc pl-5 flex-grow"
              th:utext="${#strings.listJoin(#strings.arraySplit(destination.description, '\\;'), '</li><li>')}">
          </ul>

          <!-- Dates -->
          <p class="text-gray-600 mt-2">üìÖ –î–∞—Ç–∞ –Ω–∞ –∑–∞–º–∏–Ω–∞–≤–∞–Ω–µ:
            <span th:text="${#temporals.format(destination.dateOfDeparture, 'dd-MM-yyyy')}"></span>
          </p>
          <p class="text-gray-600">üìÖ –î–∞—Ç–∞ –Ω–∞ –≤—Ä—ä—â–∞–Ω–µ:
            <span th:text="${#temporals.format(destination.dateOfReturn, 'dd-MM-yyyy')}"></span>
          </p>

          <!-- Image -->
          <img th:src="'/uploaded-image/' + ${destination.imageUrl}"
               alt="Destination Image"
               class="w-full h-40 object-cover rounded-lg mt-4">

          <!-- Other Info -->
          <p class="mt-2">üßë‚Äçü§ù‚Äçüßë –û—Å—Ç–∞–≤–∞—â–∏ –º–µ—Å—Ç–∞: <span th:text="${destination.remainingPeople}"></span></p>
          <p class="text-yellow-500 font-bold">üí∞ –¶–µ–Ω–∞:
            <span th:text="${#numbers.formatDecimal(destination.price, 2, 2)}"></span> –ª–≤.
          </p>
          <p>‚≠ê –°—Ä–µ–¥–µ–Ω —Ä–µ–π—Ç–∏–Ω–≥: <span th:text="${destination.getAverageRating()}"></span></p>
          <p>üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç: <span th:text="${destination.getPopularity()}"></span> —Ä–µ–∑–µ—Ä–≤–∏—Ä–∞–ª–∏</p>

          <!-- Closed Reservations Notice -->
          <th:block th:if="${destination.remainingPeople == 0 or destination.dateOfDeparture <= T(java.time.LocalDate).now()}">
            <p class="text-red-500 font-bold">üö´ –ó–∞—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</p>
          </th:block>

          <!-- Reserve Button (Always at Bottom) -->
          <div class="mt-auto pt-4">
            <div sec:authorize="hasAuthority('USER')">
              <th:block th:if="${destination.dateOfDeparture > T(java.time.LocalDate).now()}">
                <a th:href="@{/reservation/{id}(id=${destination.id})}">
                  <button class="btn btn-secondary w-full">–ù–∞–ø—Ä–∞–≤–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è</button>
                </a>
              </th:block>
            </div>
          </div>

        </div>
      </th:block>
    </th:block>
  </div>

</div>


  </main>

</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    let departureInput = document.getElementById("startDate");
    let returnInput = document.getElementById("endDate");

    departureInput.addEventListener("change", function () {
      if (departureInput.value) {
        returnInput.min = departureInput.value; // Set return date min to departure date
      }
      if (returnInput.value && departureInput.value > returnInput.value) {
        alert("–î–∞—Ç–∞—Ç–∞ –Ω–∞ —Ç—Ä—ä–≥–≤–∞–Ω–µ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ —Å–ª–µ–¥ –¥–∞—Ç–∞—Ç–∞ –Ω–∞ –≤—Ä—ä—â–∞–Ω–µ!");
        departureInput.value = ""; // Reset invalid departure date
      }
    });

    returnInput.addEventListener("change", function () {
      if (departureInput.value && returnInput.value < departureInput.value) {
        alert("–î–∞—Ç–∞—Ç–∞ –Ω–∞ –≤—Ä—ä—â–∞–Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ —Å–ª–µ–¥ –¥–∞—Ç–∞—Ç–∞ –Ω–∞ —Ç—Ä—ä–≥–≤–∞–Ω–µ!");
        returnInput.value = ""; // Reset invalid return date
      }
    });
  });

  document.querySelector("#userMenu").addEventListener("click", () => {
    document.getElementById("dropdownMenu").classList.toggle("hidden");
  });

  document.addEventListener("DOMContentLoaded", function () {
    document.body.classList.remove("opacity-0", "translate-y-10");
  });
</script>
</body>
</html>
